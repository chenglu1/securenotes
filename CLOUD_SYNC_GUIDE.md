# ☁️ 云同步功能使用指南

## ✅ 配置完成

云同步功能已成功配置！

---

## 🚀 使用步骤

### 1. 确保后端服务器正在运行

后端服务器应该已经在运行（在新的终端窗口）：
```bash
cd server
npm run dev
```

✅ 看到服务器启动成功（端口 3000）

---

### 2. 启动 Electron 应用

在主项目目录运行：
```bash
npm run dev
```

---

### 3. 使用云同步功能

#### **注册账号**
1. 点击左下角的 **登录图标** (LogIn icon)
2. 在弹出的模态框中选择 **"注册"**
3. 输入邮箱和密码（至少6位）
4. 点击 **"注册"** 按钮

#### **登录**
1. 点击左下角的 **登录图标**
2. 输入邮箱和密码
3. 点击 **"登录"** 按钮

#### **同步数据到云端**
登录后：
- 点击左下角的 **"云同步"** 按钮
- 你的本地笔记会自动上传到 Neon PostgreSQL
- 同步状态会显示在按钮上

#### **登出**
- 点击左下角的 **LogOut 图标**
- 应用会回到本地模式

---

## 📊 数据流

```
本地创建/编辑笔记
        ↓
SQLite (本地数据库) ✅
        ↓
点击"云同步"
        ↓
Neon PostgreSQL (云端) ✅
```

---

## 🔍 验证云同步

### 方法 1：查看 Neon 控制台
访问 https://console.neon.tech，在 `notes` 表中应该能看到数据。

### 方法 2：测试多设备同步
1. 在设备 A 创建笔记并同步
2. 在设备 B 登录同一账号
3. 笔记应该自动下载（暂未实现自动拉取，需手动刷新）

---

## 🎯 功能清单

### ✅ 已实现
- [x] 后端服务器连接 Neon PostgreSQL
- [x] 用户注册/登录 API
- [x] JWT 认证
- [x] 笔记推送到云端（push）
- [x] 前端认证界面
- [x] 本地/云端模式切换
- [x] 同步状态指示

### 🔄 待优化
- [ ] 自动拉取云端更新（pull）
- [ ] 实时协作编辑（WebSocket）
- [ ] 端到端加密（目前是明文）
- [ ] 冲突解决策略
- [ ] 离线队列（网络恢复后自动同步）
- [ ] 增量同步（只同步变更的笔记）

---

## 🔐 安全说明

**当前状态**：
- ✅ HTTPS/TLS 连接到 Neon
- ✅ JWT Token 认证
- ✅ 密码 bcrypt 加密存储
- ⚠️ 笔记内容未加密（明文存储）

**生产环境建议**：
1. 使用 libsodium 加密笔记内容
2. 密钥只保存在客户端
3. 服务器只存储密文

---

## 🐛 故障排查

### 登录失败
- 检查后端服务器是否运行（`http://localhost:3000`）
- 查看浏览器控制台错误信息
- 确认 Neon 数据库连接正常

### 同步失败
- 确认已登录
- 检查网络连接
- 查看后端日志是否有错误

### 数据未出现在 Neon
- 确认点击了"云同步"按钮
- 检查笔记的 `is_dirty` 字段（=1 表示待同步）
- 查看浏览器控制台同步日志

---

## 📝 API 端点

| 端点 | 方法 | 说明 |
|------|------|------|
| `/api/auth/register` | POST | 注册新用户 |
| `/api/auth/login` | POST | 用户登录 |
| `/api/sync/push` | POST | 推送笔记到云端 |
| `/api/sync/pull` | GET | 拉取云端更新 |
| `/api/sync/notes` | GET | 获取所有笔记 |

---

## 🎉 测试云同步

1. 启动后端：`cd server && npm run dev`
2. 启动前端：`npm run dev`
3. 点击左下角登录图标
4. 注册新账号
5. 创建一条新笔记
6. 点击"云同步"按钮
7. 访问 Neon 控制台查看数据

**成功标志**：
- ✅ 左下角显示"云同步"按钮
- ✅ 同步时显示"同步中..."
- ✅ Neon `notes` 表中有数据
- ✅ `users` 表中有你的账号

---

需要帮助？检查：
- 后端日志（终端输出）
- 浏览器控制台（F12）
- Neon 控制台数据库表
